# Copyright 2014 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# Some people have chromeos-base/chromeos listed in their @world set which
# causes binpkg-only upgrades to fail: we aren't building this package
# anymore as we've converted everyone to virtual/target-os.  So clean it out.

package="chromeos-base/chromeos"

sudo sed -i -e "/^${package//\//\/}$/d" /build/*/var/lib/portage/world
for sysroot in /build/*; do
  if qlist --root "${sysroot}" -ICe ${package} >&/dev/null; then
    info "Cleaning ${package} from ${sysroot}"
    sudo qmerge --root "${sysroot}" -yU ${package}
  fi
done
